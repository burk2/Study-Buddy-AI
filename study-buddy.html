<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Study Buddy — Real / Demo Hybrid</title>
  <style>
    /* ====== Design tokens & base ====== */
    :root{
      --bg1: linear-gradient(180deg,#0f1720 0%, #0b1220 55%);
      --card-grad: linear-gradient(135deg,#ff5f7a 0%, #7c3aed 100%);
      --accent: #ff6b81;
      --muted: #bfc8cf;
      --glass: rgba(255,255,255,0.04);
      --radius: 14px;
      --shadow: 0 6px 30px rgba(2,6,23,0.6);
      --glass-border: rgba(255,255,255,0.03);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    html,body{height:100%;margin:0;background:var(--bg1);color:#e6eef6;-webkit-font-smoothing:antialiased;}
    .app{
      max-width:1100px;margin:28px auto;padding:28px;
      display:grid;grid-template-columns: 320px 1fr;gap:20px;
      align-items:start;
    }
    /* ====== Left Knowledge Sidebar ====== */
    .kb {
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.015));
      border-radius: var(--radius);
      padding:18px;
      box-shadow: var(--shadow);
      border:1px solid var(--glass-border);
      position:relative;
      overflow:hidden;
    }
    .kb h3{margin:0 0 8px 0;font-size:18px;color:#fff}
    .kb p{margin:6px 0;color:var(--muted);font-size:13px;line-height:1.35}
    .kb .chip{display:inline-block;padding:6px 10px;background:rgba(255,255,255,0.03);border-radius:999px;margin:6px 6px 0 0;font-size:12px;color:var(--muted)}
    .kb .prompt-sample{margin-top:12px}
    .kb .prompt-sample button{
      display:block;width:100%;text-align:left;padding:10px;border-radius:10px;border:1px dashed rgba(255,255,255,0.03);
      background:transparent;color:var(--muted);cursor:pointer;margin-bottom:8px;font-size:13px;
    }
    .kb .toggle-tab{
      position:absolute;right:-34px;top:120px;width:36px;height:120px;background:linear-gradient(180deg,#ff5f7a,#7c3aed);border-radius:8px;
      display:flex;align-items:center;justify-content:center;cursor:pointer;transform:rotate(-90deg);box-shadow:0 8px 30px rgba(0,0,0,0.5);
      color:white;font-weight:700;font-size:12px;
    }

    /* ===== Main Panel ===== */
    .panel{
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius: var(--radius); padding:18px; box-shadow:var(--shadow); border:1px solid var(--glass-border);
      display:flex;flex-direction:column;height: calc(100vh - 120px);
    }
    .header{
      display:flex;align-items:center;gap:12px;margin-bottom:12px;
    }
    .logo {
      width:56px;height:56px;border-radius:12px;display:flex;align-items:center;justify-content:center;
      background:var(--card-grad);box-shadow: 0 6px 24px rgba(124,58,237,0.32);flex-shrink:0;
    }
    .logo img{width:38px;height:38px;border-radius:8px}
    .title{flex:1}
    .title h1{margin:0;font-size:18px}
    .title p{margin:2px 0 0 0;color:var(--muted);font-size:13px}
    .actions{display:flex;gap:8px;align-items:center}
    .btn{
      padding:10px 14px;border-radius:12px;background:linear-gradient(90deg,#1f2937,#111827);border:1px solid rgba(255,255,255,0.03);color:#fff;cursor:pointer;
      box-shadow: 0 6px 20px rgba(2,6,23,0.6);font-size:13px;
    }
    .btn.primary{
      background:linear-gradient(90deg,#7c3aed,#ff5f7a);
      color:white;border:none;
      box-shadow: 0 10px 30px rgba(124,58,237,0.2);
    }

    /* ===== Chat area ===== */
    .chat{
      flex:1;overflow:auto;padding:12px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.005), transparent);
      margin-bottom:12px;scroll-behavior:smooth;
    }
    .msg{display:flex;gap:12px;align-items:flex-start;margin:8px 0;opacity:0;transform:translateY(8px);animation:popIn .26s forwards}
    @keyframes popIn{to{opacity:1;transform:none}}
    .avatar{
      width:44px;height:44px;border-radius:10px;overflow:hidden;flex-shrink:0;background:linear-gradient(180deg,#fff6,#fff1);
      display:flex;align-items:center;justify-content:center;color:#1b1b1b;font-weight:700;
    }
    .bubble{
      max-width:75%;padding:12px 14px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
      border:1px solid rgba(255,255,255,0.03);
      color:#e7f0ff;font-size:14px;line-height:1.45;
    }
    .bubble.system{background:linear-gradient(180deg,#1f2937,#111827);color:#cfe9ff;border:1px solid rgba(255,255,255,0.02)}
    .bubble.user{background:linear-gradient(180deg,#fff,#f7f8fb);color:#0b1220}
    .typing{
      width:60px;height:8px;border-radius:999px;background:linear-gradient(90deg,#fff4,#fff0);
      position:relative;overflow:hidden;margin-top:6px;
    }
    .typing::after{
      content:'';position:absolute;left:-30px;top:0;height:100%;width:30px;background:linear-gradient(90deg,transparent,#ffffff55,transparent);
      animation:typingShimmer 1s linear infinite;
    }
    @keyframes typingShimmer{to{left:100%}}

    /* ===== Composer ===== */
    .composer{
      display:flex;gap:10px;align-items:center;padding:12px;border-radius:12px;background:linear-gradient(90deg, rgba(255,255,255,0.012), transparent);
      border:1px solid rgba(255,255,255,0.02);
    }
    .composer textarea{flex:1;background:transparent;border:none;color:inherit;resize:none;height:56px;font-size:14px;padding:8px;outline:none}
    .send{
      display:flex;flex-direction:column;gap:8px;
    }
    .modes{display:flex;gap:8px}
    .mode{
      padding:6px 10px;border-radius:10px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.02);cursor:pointer;font-size:13px;color:var(--muted)
    }
    .mode.active{background:linear-gradient(90deg,#7c3aed,#ff5f7a);color:white;border:none;box-shadow:0 6px 18px rgba(124,58,237,0.18)}

    /* ===== Footer small ===== */
    .footer-note{font-size:12px;color:var(--muted);text-align:center;margin-top:8px}

    /* ===== Responsive ===== */
    @media (max-width:980px){
      .app{grid-template-columns: 1fr; padding:18px}
      .kb{order:2;margin-top:12px}
      .panel{height:calc(100vh - 160px)}
    }
  </style>
</head>
<body>
  <div class="app" role="application" aria-label="Study Buddy application">
    <!-- Knowledge / Memory Sidebar -->
    <aside class="kb" id="kb">
      <h3>Knowledge & Memory</h3>
      <p><strong>Sample memory:</strong> Weak on Algebra II; prefers short examples. </p>
      <div style="margin-top:10px">
        <span class="chip">Flashcards</span>
        <span class="chip">Summaries</span>
        <span class="chip">Tutor Mode</span>
      </div>

      <div class="prompt-sample">
        <h4 style="margin:12px 0 6px 0;color:#fff;font-size:14px">Try a prompt</h4>
        <button onclick="useSample('Explain Newton\\'s Second Law like I\\'m 12')">Explain Newton's 2nd law (simple)</button>
        <button onclick="useSample('Create 5 flashcards about photosynthesis')">Create 5 flashcards (biology)</button>
        <button onclick="useSample('Quiz me on integration by parts, 5 questions')">Quiz: integration by parts</button>
      </div>

      <div style="margin-top:14px">
        <h4 style="color:#fff;margin:0 0 6px 0;font-size:14px">FAQ & Tips</h4>
        <p>• Use "Tutor" mode to get the assistant to ask questions back.</p>
        <p>• Paste long notes, then choose "Summarize" in the mode.</p>
      </div>

      <div class="toggle-tab" id="toggleKb" title="Toggle Knowledge">KB</div>
    </aside>

    <!-- Main Panel -->
    <section class="panel" id="mainPanel">
      <div class="header">
        <div class="logo" title="Study Buddy">
          <!-- small embedded svg avatar -->
          <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjY0IiBoZWlnaHQ9IjY0IiByeD0iMTYiIGZpbGw9IiNmZmYiLz4KPHBhdGggZD0iTTQ4LjA0IDM5LjM4QzQ0LjY1IDM2LjEyIDM5LjA0IDM0IDMzLjA0IDM0QzI3LjA0IDM0IDIxLjM5IDM2LjEyIDE3Ljk5IDM5LjM4QzE2Ljg1IDQwLjI3IDE2LjA1IDQxLjQ4IDE2LjA1IDQyLjg0VjQ1LjA1QzE2LjA1IDQ2LjQxIDE2Ljg1IDQ3LjYyIDE3Ljk5IDQ4LjUxQzIxLjM5IDUxLjc3IDI3LjA0IDUzLjg4IDMzLjA0IDUzLjg4QzM5LjA0IDUzLjg4IDQ0LjY1IDUxLjc3IDQ4LjA0IDQ4LjUxQzQ5LjE4IDQ3LjYyIDQ5Ljk4IDQ2LjQxIDQ5Ljk4IDQ1LjA1VjQyLjg0QzQ5Ljk4IDQxLjQ4IDQ5LjE4IDQwLjI3IDQ4LjA0IDM5LjM4WiIgZmlsbD0iI2ZmZiIvPgo8cGF0aCBkPSJNMjguNSAzNC4yNUMyNy4xNSAzNC4yNSAyNi4xIDI1Ljk1IDI2LjEgMjMuMDVDMjYuMSAyMC4xNSA3LjUgMjAuMTUgNy41IDE4QzcuNSAxNS44NSAxNy45NSAxNSAxOC4yNSAxNUgyOS44QzMwLjE1IDE1IDQwLjUgMTUuODUgNDAuNSAxOUM0MC41IDIwLjE1IDIxLjkgMjAuMTUgMjEuOSA0MC45MyIgZmlsbD0iI2E0YzQ1ZiIvPgo8L3N2Zz4=" alt="logo" />
        </div>

        <div class="title">
          <h1>Study Buddy</h1>
          <p>Smart study helper — Tutor • Quiz • Explain</p>
        </div>

        <div class="actions">
          <button class="btn" onclick="openSettings()">Settings</button>
          <button class="btn primary" id="downloadBtn">Download Prototype</button>
        </div>
      </div>

      <main class="chat" id="chat" aria-live="polite" role="log">
        <!-- messages go here -->
      </main>

      <div class="composer" role="region" aria-label="Chat composer">
        <textarea id="input" placeholder="Ask a question or paste notes..."></textarea>
        <div class="send">
          <div class="modes" role="tablist" aria-label="Modes">
            <div class="mode active" data-mode="explain">Explain</div>
            <div class="mode" data-mode="tutor">Tutor</div>
            <div class="mode" data-mode="quiz">Quiz</div>
          </div>
          <div style="display:flex;gap:8px;margin-top:8px;align-items:center">
            <button class="btn" id="clearBtn">Clear</button>
            <button class="btn primary" id="sendBtn">Send</button>
          </div>
        </div>
      </div>
      <div class="footer-note">This prototype can call OpenAI directly for demo purposes (set API key in Settings). For production, use a secure backend.</div>
    </section>
  </div>

  <!-- Settings & Onboarding modals (simple implementations) -->
  <div id="modalRoot" style="position:fixed;left:0;top:0;right:0;bottom:0;display:none;align-items:center;justify-content:center;">
    <div style="background:rgba(0,0,0,0.55);backdrop-filter:blur(4px);position:absolute;inset:0;"></div>
    <div id="modal" style="position:relative;z-index:10;width:92%;max-width:720px;border-radius:12px;padding:18px;background:linear-gradient(180deg,#071023,#0b1220);box-shadow:0 20px 60px rgba(2,6,23,0.8);border:1px solid rgba(255,255,255,0.03);">
      <!-- content injected by JS -->
    </div>
  </div>

<script>
/* ====== App Logic ====== */
/* State */
const state = {
  kbOpen: true,
  apiKey: localStorage.getItem('sb_api_key') || '',
  model: localStorage.getItem('sb_model') || 'gpt-4',
  runningRequest: false,
};

/* Helpers */
const chatEl = document.getElementById('chat');
const inputEl = document.getElementById('input');

function el(tag, cls, inner){const e = document.createElement(tag); if(cls)e.className=cls; if(inner!==undefined)e.innerHTML=inner; return e;}
function addMessage({who='system', text='', typing=false}){
  const wrap = el('div','msg');
  const avatar = el('div','avatar');
  avatar.innerHTML = who === 'user' ? `<svg width="28" height="28" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="8" r="3.2" fill="#111827"/><path d="M4 20c0-3.6 3.2-6.5 7.9-6.5S19.8 16.4 19.8 20" fill="#111827"/></svg>` : `<svg width="28" height="28" viewBox="0 0 24 24" fill="none"><rect x="2" y="2" width="20" height="20" rx="5" fill="#fff" opacity="0.06"/><path d="M7 9h10v2H7z" fill="#fff" opacity="0.9"/></svg>`;
  const bubble = el('div','bubble ' + (who === 'user' ? 'user' : 'system'));
  if(typing){
    const t = el('div','typing');
    bubble.appendChild(t);
  } else {
    bubble.innerHTML = text.replace(/\n/g,'<br/>');
  }
  wrap.appendChild(avatar);
  wrap.appendChild(bubble);
  chatEl.appendChild(wrap);
  chatEl.scrollTop = chatEl.scrollHeight;
  return {wrap,bubble};
}

/* KB toggle */
document.getElementById('toggleKb').addEventListener('click',()=>{
  const kb = document.getElementById('kb');
  state.kbOpen = !state.kbOpen;
  kb.style.display = state.kbOpen ? 'block' : 'none';
});

/* modes */
document.querySelectorAll('.mode').forEach(m=>{
  m.addEventListener('click', ()=> {
    document.querySelectorAll('.mode').forEach(x=>x.classList.remove('active'));
    m.classList.add('active');
  });
});

/* sample button */
function useSample(text){
  inputEl.value = text;
  inputEl.focus();
}

/* send */
document.getElementById('sendBtn').addEventListener('click', sendMessage);
document.getElementById('clearBtn').addEventListener('click', ()=>{chatEl.innerHTML='';});

/* settings modal */
function openSettings(){
  openModal(`
    <h2 style="margin-top:0">Settings & Keys</h2>
    <p style="color:var(--muted)">For demo/hackathon usage you can paste an OpenAI API key below. <strong>Client-side keys are insecure — use a backend in production.</strong></p>
    <label style="display:block;margin-top:10px;color:var(--muted)">OpenAI API Key</label>
    <input id="apiKeyInput" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:#fff" value="${state.apiKey || ''}" placeholder="sk-..." />
    <label style="display:block;margin-top:8px;color:var(--muted)">Model</label>
    <select id="modelSelect" style="width:100%;padding:10px;border-radius:8px;margin-top:8px;background:transparent;color:#fff">
      <option value="gpt-4"${state.model==='gpt-4'?' selected':''}>gpt-4</option>
      <option value="gpt-4o-mini"${state.model==='gpt-4o-mini'?' selected':''}>gpt-4o-mini</option>
      <option value="gpt-3.5-turbo"${state.model==='gpt-3.5-turbo'?' selected':''}>gpt-3.5-turbo</option>
    </select>
    <div style="display:flex;gap:8px;margin-top:12px;justify-content:flex-end">
      <button class="btn" onclick="closeModal()">Cancel</button>
      <button class="btn primary" onclick="saveSettings()">Save</button>
    </div>
    <hr style="margin-top:12px;border:none;border-top:1px solid rgba(255,255,255,0.03)" />
    <p style="color:var(--muted);font-size:13px">Tip: For secure deployment, host a small server (FastAPI/Express) that proxies requests to OpenAI. This demo leaks keys if used in public pages.</p>
  `);
}

/* modal helpers */
function openModal(html){
  const root = document.getElementById('modalRoot');
  const m = document.getElementById('modal');
  m.innerHTML = html;
  root.style.display = 'flex';
}
function closeModal(){document.getElementById('modalRoot').style.display = 'none';}

/* save settings */
function saveSettings(){
  const key = document.getElementById('apiKeyInput').value.trim();
  const model = document.getElementById('modelSelect').value;
  state.apiKey = key;
  state.model = model;
  localStorage.setItem('sb_api_key', key);
  localStorage.setItem('sb_model', model);
  closeModal();
  toast('Settings saved');
}

/* lightweight toast */
function toast(msg){
  const t = el('div', null, msg);
  Object.assign(t.style,{position:'fixed',right:'20px',bottom:'20px',padding:'10px 14px',background:'#111827',borderRadius:'10px',boxShadow:'0 10px 30px rgba(2,6,23,0.6)',color:'#fff'});
  document.body.appendChild(t);
  setTimeout(()=>t.style.opacity=0,2400);
  setTimeout(()=>t.remove(),3000);
}

/* Download current prototype (self-save) */
document.getElementById('downloadBtn').addEventListener('click', ()=> {
  // create the full page content and download
  const html = `<!doctype html>\n${document.documentElement.outerHTML}`;
  const blob = new Blob([html], {type:'text/html'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'study-buddy-prototype.html';
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
});

/* === Core send flow === */
async function sendMessage(){
  if(state.runningRequest) return;
  const text = inputEl.value.trim();
  if(!text) return toast('Please write a question or paste notes.');
  const mode = document.querySelector('.mode.active').getAttribute('data-mode');
  // push user message
  addMessage({who:'user', text});
  inputEl.value = '';
  // push assistant typing
  const typeNode = addMessage({who:'assistant', typing:true});
  state.runningRequest = true;

  try{
    let assistantText;
    if(state.apiKey){
      // send to OpenAI (client-side demo)
      assistantText = await callOpenAI(text, mode);
    } else {
      // local simulation fallback
      assistantText = simulatedReply(text, mode);
      // simulate network latency
      await new Promise(r=>setTimeout(r, 700 + Math.random()*900));
    }
    // replace typing bubble with actual content
    typeNode.bubble.innerHTML = assistantText.replace(/\n/g,'<br/>');
  } catch(err){
    console.error(err);
    typeNode.bubble.innerHTML = `<strong style="color:#ffb4b4">Error</strong><br/>${String(err.message || err)}`;
  } finally {
    state.runningRequest = false;
    chatEl.scrollTop = chatEl.scrollHeight;
  }
}

/* Simulated fallback reply (useful for hackathon if key not set) */
function simulatedReply(text, mode){
  // very lightweight heuristic-based replies for demo
  if(mode==='quiz'){
    return `Quiz time! Here are 3 quick questions based on your input:\n\n1) (Short question) ...\n2) (Short question) ...\n3) (Short question) ...\n\nAnswer and I will check them.`;
  }
  if(mode==='tutor'){
    return `Tutor mode engaged — I'll ask you questions to probe understanding:\n\nQ1: Can you summarize the main idea in one sentence?\n\n(Respond and I'll follow up)`;
  }
  // explain mode
  if(text.length < 80) {
    return `Sure — here's a concise explanation for: "${text}"\n\n• Short definition\n• Simple example\n• Next steps to practice`;
  }
  return `Thanks — I summarized your notes:\n\n${text.slice(0,240)}...\n\n(Use "Quiz" to convert this into 5 flashcards.)`;
}

/* Call OpenAI (client-side) - demo only */
async function callOpenAI(userText, mode){
  // Build prompt wrapper depending on mode
  let systemPrompt = "You are a friendly, patient study assistant. Give clear, concise explanations, and adapt to 'Tutor', 'Quiz', or 'Explain' modes. Use examples and short practice questions when relevant.";
  let modePrompt = '';
  if(mode==='tutor'){
    modePrompt = 'Act as an interactive tutor: ask the user probing questions instead of only giving answers.';
  } else if(mode==='quiz'){
    modePrompt = 'Generate a short quiz (3-5 questions) based on the user input; include answers separately.';
  } else {
    modePrompt = 'Explain the content clearly and concisely with examples and next steps to practice.';
  }

  const messages = [
    {role:'system', content: systemPrompt},
    {role:'user', content: `${modePrompt}\n\nUser content:\n${userText}`}
  ];

  // Basic fetch to Chat Completions (client-side demo)
  const resp = await fetch('https://api.openai.com/v1/chat/completions', {
    method:'POST',
    headers:{
      'Content-Type':'application/json',
      'Authorization': 'Bearer ' + state.apiKey
    },
    body: JSON.stringify({
      model: state.model,
      messages,
      max_tokens: 800,
      temperature: 0.2,
      n: 1
    })
  });
  if(!resp.ok){
    const errText = await resp.text();
    throw new Error('OpenAI Error: ' + resp.status + ' — ' + errText.slice(0,250));
  }
  const data = await resp.json();
  const out = data.choices && data.choices[0] && data.choices[0].message && data.choices[0].message.content;
  if(!out) throw new Error('No content returned from model.');
  return out;
}

/* small startup onboarding message (modal) */
window.addEventListener('load', ()=>{
  openModal(`
    <h2 style="margin-top:0">Welcome to Study Buddy</h2>
    <p style="color:var(--muted)">This prototype can operate in two ways:</p>
    <ol style="color:var(--muted)">
      <li><strong>Demo mode:</strong> No API key needed; assistant uses scripted replies to simulate behavior.</li>
      <li><strong>Live mode:</strong> Provide an OpenAI API key in Settings for real responses (client-side demo only).</li>
    </ol>
    <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
      <button class="btn" onclick="closeModal()">Continue</button>
      <button class="btn primary" onclick="openSettings()">Open Settings</button>
    </div>
  `);
});

/* small accessibility helpers */
inputEl.addEventListener('keydown', (e)=>{ if(e.key==='Enter' && (e.ctrlKey || e.metaKey)) sendMessage(); });

</script>
</body>
</html>
